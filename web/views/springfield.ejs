<!DOCTYPE html>
<!-- Mapping air pollution data for Springfield, Massachusetts using WebWorldWind. -->

<html>

	<head lang="en">
		<%- commonHeader %>
		<title>Springfield Data Visualization</title>
		<!-- Include the Web World Wind library. -->
		<script src="http://worldwindserver.net/webworldwind/worldwindlib.js" type="text/javascript"></script>
		<script src="/js/jquery-3.1.0.slim.min.js" type="text/javascript"></script>
		<script src="/js/bootstrapslider.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css"/>
		<link type="text/css" rel="stylesheet" href="/css/bootstrapslider.css">
			<!-- Should the following style code be moved to stylesheet?-->
		<style>	#ex1Slider .slider-selection {
			background: #BABABA;
			}
		</style>
	</head>

	<body id ="home">
		<%- commonNavigation %>
		<div id = maincontent class="container-fluid">
			<div class="col-sm-12">
				<h2 id="subtitle">Air Quality in Springfield, Massachusetts, USA</h2>
			</div>
			<div class=row>
				<div class="col-sm-3">
					<input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="10" data-slider-max="15" data-slider-step="1" data-slider-value="0" data-slider-tooltip="hide"/>
						<span id='time'>0:00</span>
					<form action="">
						<input type="radio" name="airquality" value="ozone" checked>Ozone <br>
						<input type="radio" name="airquality" value="carbonm">Carbon Monoxide<br>
					</form>
				</div>
				<div class="col-sm-6">
					<!-- Create a canvas for Web World Wind. -->
					<canvas id="canvasOne" width="600" height="700"></canvas>

					    </div>
                        </div>
                    

	<script>
	
		var slider = new Slider('#ex1', {
		});
		
		function colorcode(data, value_radiob){
		var value_radiob = $('input:radio[name=airquality]:checked').val();
			if (value_radiob=="ozone"){
				var red=0; var green=0; var blue=0;
				if (data<=45){
					red=49/255; green=163/255; blue=84/255;
					}
				if (data>45 && data<=60){
					red=254/255; green=196/255; blue=79/255;
					}	
				if (data>60){
					red=240/255; green=59/255; 	blue=32/255;
					}
				return new WorldWind.Color(red, green, blue, 1);
			}
			if (value_radiob=="carbonm"){
				var red=0; var green=0; var blue=0;
				if (data<=2.5){
					red=255/255; green=247/255; blue=188/255;    
					}
				if (data>2.5 && data<=4){
					red=254/255; green=196/255; blue=79/255;
					}
				if (data>4){
					red=217/255; green=95/255; 	blue=14/255;   
					}
			return new WorldWind.Color(red, green, blue, 1);
			}
		}
			
		// Register an event listener to be called when the page is loaded.
		window.addEventListener("load", eventWindowLoaded, false);
		
		// Define the event listener to initialize Web World Wind.
		function eventWindowLoaded() {
		
			// Create a World Window for the canvas.
			var wwd = new WorldWind.WorldWindow("canvasOne");
		
			// Add some image layers to the World Window's globe.
			wwd.addLayer(new WorldWind.BMNGOneImageLayer());
			wwd.addLayer(new WorldWind.BingAerialWithLabelsLayer());

			// Add a compass, a coordinates display and some view controls to the World Window.
			wwd.addLayer(new WorldWind.CompassLayer());
			wwd.addLayer(new WorldWind.CoordinatesDisplayLayer(wwd));
			wwd.addLayer(new WorldWind.ViewControlsLayer(wwd));
		
			//Making the slider change the data by hour
			slider.on('change', function(data)
			{var hour=data.newValue+'h';
			placemarks(hour);
			$('#time').text(data.newValue + ':00');
			});
				
			// Adjust the Navigator to place Springfield in the center of the Web World Window.
			wwd.navigator.lookAtLocation.latitude = 42.107821;   
			wwd.navigator.lookAtLocation.longitude = -72.588895;    
				// Approx. 3000 meters above the ellipsoid
				wwd.navigator.range = 3e3; 
				// Tilt globe by 45 degrees for 3D view
				wwd.navigator.tilt = 45;

			//Ozone 
			var aq = {
				'Trees': {'lat': 42.103475, 'lon': -72.591092, 
					'ozone': {'10h':51.0855225, '11h': 54.665, '12h': 63.65606, '13h':51.0855225, '14h': 37.98264, '15h': 48.03839},
					'carbonm': {'10h':4.190411, '11h': 1.634839, '12h': 2.503061, '13h': 2.9766442, '14h':3.187332, '15h':3.367578}
				},
				'NoTrees': {'lat': 42.103283, 'lon': -72.592528,
					'ozone': {'10h': 32.13295, '11h': 69.19525, '12h': 67.8464, '13h': 68.37934, '14h':59.388485, '15h':59.388485},
					'carbonm': {'10h':2.238302, '11h': 4.546313, '12h': 5.804047, '13h': 3.794387, '14h':4.09576225, '15h':4.09576225}
				}
			};

		//Placing placemarks with air pollution data by hour
	
		placemarks('0h');
			function placemarks(hour){
			var value_radiob = $('input:radio[name=airquality]:checked').val();
					
			//Add a placemark at Trees, Springfield
			placemarkAttributes = new WorldWind.PlacemarkAttributes();
			placemarkAttributes.imageScale = 15;
			placemarkAttributes.imageColor = colorcode(aq.Trees[value_radiob][hour],value_radiob);  
			var placemark = new WorldWind.Placemark(
				new WorldWind.Position(aq.Trees.lat,aq.Trees.lon,50),
				true,
				placemarkAttributes
			);
			var placemarkLayer = new WorldWind.RenderableLayer("Placemarks");
			placemarkLayer.addRenderable(placemark);
			wwd.addLayer(placemarkLayer);
		
			//Add a placemark at NoTrees, Springfield
			placemarkAttributes = new WorldWind.PlacemarkAttributes();
			placemarkAttributes.imageScale = 15;
			placemarkAttributes.imageColor = colorcode(aq.NoTrees[value_radiob][hour],value_radiob);  
			var placemark = new WorldWind.Placemark(
				new WorldWind.Position(aq.NoTrees.lat,aq.NoTrees.lon, 50),
				true,
				placemarkAttributes
			);
			var placemarkLayer = new WorldWind.RenderableLayer("Placemarks");
			placemarkLayer.addRenderable(placemark);
			wwd.addLayer(placemarkLayer);
		
			
		}
	}
	</script>
	
	<iframe width="900" height="800" frameborder="0" scrolling="no" src="https://plot.ly/~pkharel/21.embed"></iframe>
	<iframe width="900" height="800" frameborder="0" scrolling="no" src="https://plot.ly/~pkharel/23.embed"></iframe>
	
	<div class="page-header">
      </div>
      <div class="row">
        <div class="col-sm-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Introduction</h3>
            </div>
            <div class="panel-body">
			Exposures to traffic pollution in any part of the world can have adverse consequences on an individual’s health. In the US context, such health consequences are even more pronounced in the state of Massachusetts, according to the Center for Diseases Control and Prevention. Springfield is the third largest city in Massachusetts situated in the western part of New England. In 2010, the metropolitan area had a population of approximately 700,000 people. According to a news <a href="http://www.masslive.com/living/index.ssf/2012/06/many_triggers_for_asthmas_rise_in_the_northeast.html">article</a> published in 2012, childhood asthma rate in Springfield was as high as 17%, higher than both the state and national averages. 
            <br><br>
			Given the high rates of childhood asthma prevalence in Springfield , our study investigated the role of urban trees in improving air quality caused by traffic pollution. By employing arduino sensors developed by UMass Amherst students, we collected data on ozone and carbon monoxide in two unique locations to assess whether the City of Springfield should invest in more urban tree planting in an effort to provide cleaner air for their citizens.
		  </div>
		</div>
        </div><!-- /.col-sm-5 -->
		</div>
	 <div class="row">
		<div class="col-sm-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Methods</h3>
            </div>
            <div class="panel-body">
			High School Kids Trained: 'Make-It Springfield’ is a community driven creativity center located on Worthington Street in Downtown Springfield (https://www.facebook.com/MakeItSpringfield/).  Any member of the community can go for workshops on art, technology, and a variety of other useful skills and hobbies.  Portions of our NASA Europa Challenge  team  put on a workshop for Springfield youth focusing on the basics of the Arduino board and Arduino coding and on the development of the Arduino Air Quality Sensor (see main menu). We also promoted the NASA World Wind Open City Smart air quality project to expose the idea of urban smart cities and, more broadly,  the idea of citizen science.  The high schoolers practiced by writing a code which made an LED light blink at whatever frequency they set.  They also helped to assemble the Arduino air sensors which would be used in the field by wiring the air sensors to the arduino board.Later in the week Jack and Dominic took some of the Springfield high school youth out into the streets of Springfield to deploy the Arduino-based air sensors.  These youth visited two urban park locations (see below), set up the devices and watched as the devices collected data on carbon monoxide and ozone.  These city high school youth were amazed that the machines they had just assembled a few days earlier were now gathering scientific data! Locations Chosen: To test the hypothesis that urban trees influence air quality, we selected  two urban park locations, one with significant tree canopy, the other without. The two parks were carefully selected because of their similar traffic patterns and difference in green space.  Both locations were on the corner of Main Street and Bridge Street in downtown Springfield.  They were located diagonally across from each other.  Main Street is one of the most frequently used roads in Springfield.  With so many cars emitting harmful pollutants into the air, Main Street may have the worst air quality in Western Massachusetts. 
            <br><br>
			Deployment: Members of our UMass Europa Challenge team, often with Springfield high school youth, would meet at the park location usually during mid-day.  Some days, team members would split up and log data at two different locations. Other days, the team would stay together and use multiple sensors at the same location.  This was done because on the days the team was together they could compare machines and see the differences in data from each machine.  On days they were separated they could compare the data from each location and check for trends.  The team recorded data six separate days. To start collecting data a team member would plug the Arduino into a laptop and run the software. The process involved waiting twenty minutes for the machine to warm up and calibrate.  Data would then be collected using a software program called “Cool Term” which saves the data as it is collected.  Data could only be collected for about two hours before the machines began to heat up too much and skew the data.  The Arduino would have to be unplugged for at least 30 minutes before the team member could again begin the process of warming up the machine to collect more data. The placement of the machine was critical to the integrity of the results.  Data taken in the park would be taken in the shade in order to fully represent the impact of the trees in the data.  On the same token data from the courtyard would be taken in direct sunlight.  Another important factor was reducing the effects of wind. The arduinos would be placed in an open box, the sensors would still receive air flow, but would shield the sensors from the wind. With the data collected, Jack and Dom provided the data to Europa Challenge team member Palista Kharel to analyze and map using NASA WebWorldWind (visualized above).
			</div>
          </div>
        </div><!-- /.col-sm-4 -->
      </div>
	  <div class="row">
        <div class="col-sm-8">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Results</h3>
            </div>
            <div class="panel-body">
			Overview: This study found that high levels of exposure to PM2.5 is associated with reduced lung function, and increased exposure to Black Carbon leads to reduced lung function among non-smokers. All findings were statistically significant. In both cases of PM2.5 and Black Carbon, there is a clear spatial pattern with higher levels of pollutant concentrations in the ring road surrounding Kathmandu Valley (Balaju, Chabahil) and relatively lower levels of concentrations inside the city (Jawalakhel, Thapathali).
            <br><br>
			The average PM2.5 over time resembles a double inverted U-shaped graph and peaks during the morning rush hour at 9 am. Average PM2.5 exposure levels are as high as approximately 160 µg/m3 during this hour. During the evening rush hour at 7 pm, the average PM2.5 exposure levels are slightly lower at approximately 110 µg/m3. Similarly, the average BC over time also resembles a double inverted U-shaped graph but peaks earlier during the morning rush hour at 7 am. Average BC exposure levels are as high as approximately 33,000 µg/m3 during this hour. During the evening rush hour, the average BC exposure levels peak at 5 pm and are slightly lower at almost 20,000 µg/m3. Both these measurements pose risky consequences of exposure on human health. 
		  </div>
		  </div>
		</div>
		<div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Discussion</h3>
            </div>
            <div class="panel-body">
			Our study showed a negative association between air pollutants such as PM2.5 and black carbon, and individual health measures. As a future step, we intend to further assess how the current load shedding policy in Kathmandu Valley affects the air quality that its citizens are subjected to. We will specifically test for whether Black Carbon is higher during specific times of the day in locations where there is load shedding. The overall goal of this future step is to understand how local municipal policy on load shedding affects geospatial and temporal air quality, as a result of  temporary increase in the use of diesel generators.
		  </div>
		  </div>
		</div>
	  </div>
	</div>
	<%-commonFooter%>

	</body>
</html>


